# crules - ユーザー利用方法

## 1. インストール方法

### 1.1 Homebrew を使用したインストール

```bash
brew install crules
```

## 2. 基本的な使い方

### 2.1 プロジェクトの初期化

テンプレートからプロジェクトルールとノートを配置します。オプションで、テンプレートディレクトリ名を指定することもできます。

```bash
# プロジェクトのルートディレクトリで実行
crules init
# または、テンプレートディレクトリ名を指定
crules init flutter
```

このコマンドを実行すると、以下の処理が行われます：

- テンプレートディレクトリ内のファイルを検証
- 検証に合格したファイルが適切な位置に配置される
  - プロジェクトルール: `/.cursor/rules/` 以下に配置
  - プロジェクトノート: `/.notes/` 以下に配置

### 2.2 編集済みファイルの配置

編集したファイルを適切な位置に配置します。オプションで、テンプレートディレクトリ名を指定することもできます。

```bash
# 編集済みファイルを配置
crules deploy
# または、テンプレートディレクトリ名を指定
crules deploy flutter
```

このコマンドを実行すると、以下の処理が行われます：

- `/template` ディレクトリ以下の編集済みファイルが検証される
- 検証に合格したファイルが適切な位置に配置される
  - プロジェクトルール: `/.cursor/rules/` 以下に配置
  - ノートは配置されません（開発中に更新されるため）

### 2.3 利用可能なルールの一覧表示

現在利用可能なルールの一覧を表示します。オプションで、テンプレートディレクトリ名を指定することもできます。

```bash
# 利用可能なルールの一覧を表示
crules list
# または、テンプレートディレクトリ名を指定
crules list flutter
```

## 3. 高度な使い方

### 3.1 ルールの階層構造の管理

ルールはディレクトリを使用して階層構造にすることができます。テンプレートディレクトリ内のファイルを編集し、適切な位置に配置してください。

```bash
# テンプレートディレクトリ内のファイルを編集
# 編集後、以下のコマンドを実行して配置
crules deploy
```

これにより、以下のような階層構造が作成されます：

- `frontend/coding_standards.mdc`
- `backend/coding_standards.mdc`

### 3.2 ノートの管理

ノートも同様に管理できます。Cursor エディタで直接編集・作成できます。

### 3.3 ノートの階層構造の管理

ノートも階層構造を持つことができます。Cursor エディタで直接編集・作成できます。

## 4. ワークフロー例

### 4.1 新規プロジェクトのセットアップ

1. プロジェクトのルートディレクトリに移動
2. `crules init` を実行してプロジェクトルールとノートを配置
3. テンプレートディレクトリ内のファイルを編集
4. `crules deploy` を実行して編集済みファイルを配置

### 4.2 既存プロジェクトへのルール追加

1. プロジェクトのルートディレクトリに移動
2. テンプレートディレクトリ内のファイルを編集
3. `crules deploy` を実行して編集済みファイルを配置

### 4.3 特定のテンプレートディレクトリのルールを配置

1. プロジェクトのルートディレクトリに移動
2. テンプレートディレクトリ内のファイルを編集
3. `crules deploy flutter` を実行して、`flutter`ディレクトリの編集済みファイルを配置

## 5. 注意事項

- プロジェクトルールは編集不可です。編集するには、テンプレートファイルを編集し、`crules deploy` を実行する必要があります。
- ノートは直接編集可能です。開発中に更新されるため、`deploy`コマンドでは配置されません。
- 既存ファイルの上書きは確認が必要です。
- プロジェクトルートでの実行を前提としています。
- すべてのマークダウンファイルには YAML マターが必要です。

## 6. テンプレートディレクトリの説明

crules ツールは、プロジェクトルート直下の`/template`ディレクトリにテンプレートファイルを格納します。このディレクトリには、プロジェクトタイプごとのサブディレクトリ（例：`app`、`flutter`）が含まれています。

各テンプレートディレクトリには、以下のような構造があります：

```
/template
  ├── app/           # アプリケーション開発用
  │   ├── rules/     # プロジェクトルール
  │   └── notes/     # プロジェクトノート
  └── flutter/       # Flutter開発用
      ├── rules/     # プロジェクトルール
      └── notes/     # プロジェクトノート
```

テンプレートディレクトリ内のファイルを編集し、`crules deploy`コマンドを実行することで、編集したファイルが適切な位置に配置されます。プロジェクトルールは`/.cursor/rules/`以下に、プロジェクトノートは`/.notes/`以下に配置されます。

## 7. テンプレートディレクトリの詳細ガイド

### 7.1 テンプレートディレクトリの構造

テンプレートディレクトリは、プロジェクトタイプごとにサブディレクトリを持ちます。各サブディレクトリには、`rules/`と`notes/`の 2 つのディレクトリが含まれています。

```
/template
  ├── app/                # アプリケーション開発用
  │   ├── rules/          # プロジェクトルール
  │   │   ├── general.mdc # 一般的なルール
  │   │   ├── frontend/   # フロントエンド関連のルール
  │   │   │   ├── react.mdc
  │   │   │   └── vue.mdc
  │   │   └── backend/    # バックエンド関連のルール
  │   │       ├── api.mdc
  │   │       └── database.mdc
  │   └── notes/          # プロジェクトノート
  │       ├── setup.md    # セットアップ手順
  │       └── architecture.md # アーキテクチャ設計
  └── flutter/            # Flutter開発用
      ├── rules/          # プロジェクトルール
      │   ├── general.mdc # 一般的なルール
      │   ├── ui.mdc      # UI関連のルール
      │   └── state.mdc   # 状態管理のルール
      └── notes/          # プロジェクトノート
          ├── setup.md    # セットアップ手順
          └── widgets.md  # ウィジェット設計
```

### 7.2 ファイル形式と命名規則

#### プロジェクトルール（.mdc）

プロジェクトルールファイルは`.mdc`拡張子を持ち、YAML front matter を含む必要があります。

```markdown
---
description: "このルールの概要を記述します"
globs: src/**/*.ts, src/**/*.tsx
alwaysApply: false
---

# コーディング規約

このプロジェクトでは、以下のコーディング規約に従ってください。
...
```

#### プロジェクトノート（.md）

プロジェクトノートファイルは`.md`拡張子を持ち、同様に YAML front matter を含む必要があります。

```markdown
---
description: "このノートの概要を記述します"
globs: src/**/*.ts, src/**/*.tsx
alwaysApply: false
---

# アーキテクチャ設計

このプロジェクトは、以下のアーキテクチャに基づいています。
...
```

### 7.3 テンプレートディレクトリの使用方法

#### テンプレートの選択

プロジェクトの初期化時に、適切なテンプレートディレクトリを選択します。

```bash
# アプリケーション開発用のテンプレートを使用
crules init app

# Flutter開発用のテンプレートを使用
crules init flutter
```

#### テンプレートの編集

テンプレートディレクトリ内のファイルを編集して、プロジェクトに合わせたルールやノートを作成します。

```bash
# テンプレートディレクトリ内のファイルを編集
vim template/app/rules/general.mdc
```

#### テンプレートの配置

編集したテンプレートファイルを適切な位置に配置します。

```bash
# 編集したテンプレートファイルを配置
crules deploy app
```

### 7.4 カスタムテンプレートの作成

新しいプロジェクトタイプのテンプレートを作成するには、以下の手順に従います。

1. テンプレートディレクトリに新しいサブディレクトリを作成します。

```bash
mkdir -p template/custom/rules
mkdir -p template/custom/notes
```

2. 必要なルールファイルとノートファイルを作成します。

```bash
# ルールファイルの作成
cat > template/custom/rules/general.mdc << 'EOF'
---
title: 一般的なルール
description: カスタムプロジェクトの一般的なルール
category: general
---

# 一般的なルール

このプロジェクトでは、以下のルールに従ってください。
...
EOF

# ノートファイルの作成
cat > template/custom/notes/setup.md << 'EOF'
---
title: セットアップ手順
description: カスタムプロジェクトのセットアップ手順
category: setup
---

# セットアップ手順

このプロジェクトのセットアップ手順は以下の通りです。
...
EOF
```

3. 新しいテンプレートを使用してプロジェクトを初期化します。

```bash
crules init custom
```

### 7.5 テンプレートの共有と管理

テンプレートディレクトリは、GitHub などのバージョン管理システムで管理することができます。これにより、チーム全体でテンプレートを共有し、更新することができます。

```bash
# テンプレートディレクトリをGitHubにプッシュ
git add template/
git commit -m "Update templates"
git push origin main
```

### 7.6 トラブルシューティング

#### テンプレートディレクトリが見つからない場合

テンプレートディレクトリが存在しない場合、以下のエラーメッセージが表示されます。

```
テンプレートディレクトリが存在しません: /path/to/template/custom
```

この場合、テンプレートディレクトリが正しく作成されているか確認してください。

#### YAML front matter の検証に失敗した場合

YAML front matter の検証に失敗した場合、以下のエラーメッセージが表示されます。

```
YAMLマターの検証に失敗しました: /path/to/template/app/rules/general.mdc
```

この場合、YAML front matter の形式が正しいか確認してください。YAML front matter は、ファイルの先頭に`---`で囲まれた形式である必要があります。
